"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9944],{761:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>g,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var t=a(8168),o=a(8587),r=(a(6540),a(5680)),i=["components"],l={id:"tofu.logging.loggable",title:"Loggable typeclass"},g=void 0,s={unversionedId:"tofu.logging.loggable",id:"tofu.logging.loggable",title:"Loggable typeclass",description:"To represent a value in logs we use a concept of Loggable (it's a typeclass). It describes how a value of some type",source:"@site/../docs/tofu.logging.loggable.md",sourceDirName:".",slug:"/tofu.logging.loggable",permalink:"/tofu/docs/tofu.logging.loggable",draft:!1,tags:[],version:"current",lastUpdatedBy:"Anton Voitsishevskii",lastUpdatedAt:1726567069,formattedLastUpdatedAt:"Sep 17, 2024",frontMatter:{id:"tofu.logging.loggable",title:"Loggable typeclass"},sidebar:"docs",previous:{title:"tofu.syntax.logging",permalink:"/tofu/docs/tofu.logging.syntax"},next:{title:"Logback Layouts",permalink:"/tofu/docs/tofu.logging.layouts"}},p={},d=[{value:"Loggable example",id:"loggable-example",level:3},{value:"Loggable derivation",id:"loggable-derivation",level:2},{value:"Configuring Loggable generation",id:"configuring-loggable-generation",level:3}],m={toc:d},c="wrapper";function u(e){var n=e.components,a=(0,o.A)(e,i);return(0,r.yg)(c,(0,t.A)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"To represent a value in logs we use a concept of ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable")," (it's a typeclass). It describes how a value of some type\ncan be logged, both as a string representation in log message and as a component of structured logging. Given an\ninstance of ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable")," for a type, a value of the type can be converted into the final internal representation\ncalled ",(0,r.yg)("inlineCode",{parentName:"p"},"LoggedValue")," and thus logged in a way that you provided.",(0,r.yg)("br",{parentName:"p"}),"\n","There are multiple predefined ways to create an instance of ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable"),", many of them can be found\nin ",(0,r.yg)("inlineCode",{parentName:"p"},"tofu.logging.Loggable")," object:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"Loggable.empty")," for no-op logging of value"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"Loggable.show")," for using ",(0,r.yg)("inlineCode",{parentName:"li"},"cats.Show")," instance as string representation"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"Loggable.either")," for logging either of ",(0,r.yg)("inlineCode",{parentName:"li"},"A")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"B")),(0,r.yg)("li",{parentName:"ul"},"provided instances for all primitive types, as well as stdlib's collections and collections from Cats"),(0,r.yg)("li",{parentName:"ul"},"java.time.* instances")),(0,r.yg)("p",null,"Of course, you can describe your ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable")," instance yourself by extending existing traits that pre-implement some\nfunctionality:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"DictLoggable")," for multi-field objects"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"ToStringLoggable")," for using ",(0,r.yg)("inlineCode",{parentName:"li"},".toString")," for logging"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"HideLoggable")," to exclude value from logging")),(0,r.yg)("h3",{id:"loggable-example"},"Loggable example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-scala:reset"},'import tofu.logging._\nimport cats.syntax.semigroup._\n\ncase class User(name: String, surname: String)\n\nimplicit val userLoggable = new DictLoggable[User] {\n  override def fields[I, V, R, S](a: User, i: I)(implicit r: LogRenderer[I, V, R, S]): R = {\n    r.addString("name", a.name, i) |+| r.addString("surname", a.surname, i)\n  }\n\n  override def logShow(a: User): String = s"name = ${a.name}, surname = ${a.surname}"\n}\n')),(0,r.yg)("p",null,"Let's take a look at this example.",(0,r.yg)("br",{parentName:"p"}),"\n","First, we define a loggable for our ",(0,r.yg)("inlineCode",{parentName:"p"},"User")," class as a ",(0,r.yg)("inlineCode",{parentName:"p"},"DictLoggable")," which means that we want to log it as a multi-field\nobject with structure.",(0,r.yg)("br",{parentName:"p"}),"\n","Second, we define two methods that describe how ",(0,r.yg)("inlineCode",{parentName:"p"},"User")," should be logged:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"fields"),", that represents ",(0,r.yg)("inlineCode",{parentName:"li"},"User")," as a structure, containing two fields with their respective names and values"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"logShow"),", that represents ",(0,r.yg)("inlineCode",{parentName:"li"},"User")," as a string in a log message")),(0,r.yg)("h2",{id:"loggable-derivation"},"Loggable derivation"),(0,r.yg)("p",null,"a\nTofu has integration with ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/tofu-tf/derevo"},"derevo")," library. It allows you to easily generate\ninstances of ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable[YourClass]")," for case classes or ADTs:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-scala:reset"},"import tofu.logging.derivation.loggable\nimport derevo.derive\n\n@derive(loggable)\ncase class Query(value: String, size: Int, isTagged: Tagged, tag: Tag)\n\n@derive(loggable)\ncase class Tagged(b: Option[Boolean])\n\n@derive(loggable)\nsealed trait Tag\n\n@derive(loggable)\ncase class DatabaseTag(db: String) extends Tag\n\n@derive(loggable)\ncase object InMemoryTag extends Tag\n")),(0,r.yg)("p",null,"so when logged"),(0,r.yg)("h3",{id:"configuring-loggable-generation"},"Configuring Loggable generation"),(0,r.yg)("p",null,"Tofu has several annotations to configure generation of ",(0,r.yg)("inlineCode",{parentName:"p"},"Loggable")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"@hidden")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-scala:reset"},"import tofu.logging.derivation.{loggable, hidden}\nimport derevo.derive\n\n@derive(loggable)\ncase class User(name: String, @hidden() password: String)\n\n")),(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},'User("tofu", "pass")')," will be logged as ",(0,r.yg)("inlineCode",{parentName:"p"},"User{name=tofu}"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"@masked")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-scala:reset"},"import tofu.logging.derivation.{loggable, masked, MaskMode}\nimport derevo.derive\n\n@derive(loggable)\ncase class Card(@masked(MaskMode.Erase) expirationDate: String, @masked(MaskMode.ForLength(4, 12)) cardNumber: String, @masked() owner: String)\n\n")),(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},'Card(737, "1244345632322311", "TOFU PETROV")')," will be logged as\n",(0,r.yg)("inlineCode",{parentName:"p"},"Card{expirationDate=...,cardNumber=1244########2311,owner=**** ******}"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"@unembed")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-scala:reset"},"import tofu.logging.derivation.{loggable, unembed}\nimport derevo.derive\n\n@derive(loggable)\ncase class Scientist(@unembed owner: Person, age: Option[Int])\n\n@derive(loggable)\ncase class Person(name: String)\n")),(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},'Room(Person("Karl Sagan"), None)')," will be logged as ",(0,r.yg)("inlineCode",{parentName:"p"},"Room{name=Karl Sagan, age=None}")))),(0,r.yg)("p",null,"These annotations belong to a separate dependency-free package ",(0,r.yg)("inlineCode",{parentName:"p"},"logging-derivation-annotations"),".\nMain ",(0,r.yg)("inlineCode",{parentName:"p"},"logging-derivation")," package depends on it.\nIt allows for adding these annotations right to your domain classes if there's a need to keep it without dependencies."))}u.isMDXComponent=!0},5680:(e,n,a)=>{a.d(n,{xA:()=>p,yg:()=>u});var t=a(6540);function o(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach(function(n){o(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})}return e}function l(e,n){if(null==e)return{};var a,t,o=function(e,n){if(null==e)return{};var a,t,o={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var g=t.createContext({}),s=function(e){var n=t.useContext(g),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},p=function(e){var n=s(e.components);return t.createElement(g.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},c=t.forwardRef(function(e,n){var a=e.components,o=e.mdxType,r=e.originalType,g=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(a),c=o,u=d["".concat(g,".").concat(c)]||d[c]||m[c]||r;return a?t.createElement(u,i(i({ref:n},p),{},{components:a})):t.createElement(u,i({ref:n},p))});function u(e,n){var a=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=c;var l={};for(var g in n)hasOwnProperty.call(n,g)&&(l[g]=n[g]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);