<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-logging.old" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Logging | Tofu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://tofu-tf.github.io/tofu/docs/logging.old"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Logging | Tofu"><meta data-rh="true" name="description" content="This page is obsolete. Head on to the new docs on logging."><meta data-rh="true" property="og:description" content="This page is obsolete. Head on to the new docs on logging."><link data-rh="true" rel="icon" href="/tofu/img/tofu_logo_turquose_square.svg"><link data-rh="true" rel="canonical" href="https://tofu-tf.github.io/tofu/docs/logging.old"><link data-rh="true" rel="alternate" href="https://tofu-tf.github.io/tofu/docs/logging.old" hreflang="en"><link data-rh="true" rel="alternate" href="https://tofu-tf.github.io/tofu/docs/logging.old" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/tofu/blog/rss.xml" title="Tofu RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tofu/blog/atom.xml" title="Tofu Atom Feed">




<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/tofu/assets/css/styles.d338a015.css">
<link rel="preload" href="/tofu/assets/js/runtime~main.69bc1755.js" as="script">
<link rel="preload" href="/tofu/assets/js/main.90d0e17d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like Tofu, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/tofu-tf/tofu">GitHub</a>! ⭐</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tofu/"><div class="navbar__logo"><img src="/tofu/img/tofu_logo_turquose_square.svg" alt="Tofu" class="themedImage_ToTc themedImage--light_HNdA"><img src="/tofu/img/tofu_logo_turquose_square.svg" alt="Tofu" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tofu/docs/">Docs</a><a href="/tofu/api/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Warning</h1><p>This page is obsolete. Head on to the <a href="/tofu/docs/tofu.logging.home">new docs on logging</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2><p>Logging are available as a separate project
<code>&quot;tf.tofu&quot; %% &quot;tofu-logging&quot; % tofu-version</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preface">Preface<a href="#preface" class="hash-link" aria-label="Direct link to Preface" title="Direct link to Preface">​</a></h3><p>Almost every application nowadays does logging, whether it is logging of business events, history of some state of
application or even debug record sequences. We log to files, distributed systems, standard outputs of OSes, and we got
used to it so much it seems simple to us. Many existing libraries provide many ways of logging from your application&#x27;s
code, either automatic or manual.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-wrong-and-how-to-fix-that">What&#x27;s wrong (and how to fix that)?<a href="#whats-wrong-and-how-to-fix-that" class="hash-link" aria-label="Direct link to What&#x27;s wrong (and how to fix that)?" title="Direct link to What&#x27;s wrong (and how to fix that)?">​</a></h3><p>First, logging is, in fact, a side effect. Whether we log anything to standard output or a file — it&#x27;s an interaction
with the outside world (&#x27;outside&#x27; relative to our program). Thus, logging as a process can be represented as an effect
and operations - as an algebra.<br>
<!-- -->Second, logging itself seems easy, but stuff around it - not so much. MDC, contexts, structured logging - all these
things are very helpful on a day-to-day basis, allowing us to read and write our logs, making them clean, comprehensible
and useful for many purposes. But there are few simple ways to provide all this functionality without bleeding and
screaming from seeing over-engineered solutions.<br>
<!-- -->Tofu offers an easy and understandable abstraction over logging (it&#x27;s even named like this!) but keeping in mind that
logging is an effect that can be composed.<br>
<!-- -->It looks very similar to interfaces we all are used to (from SLF4J and other logging libraries and facades), introducing
some new concepts:</p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.LoggedValue</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">trait Logging[F[_]] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def trace(message: String, values: LoggedValue*): F[Unit]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def debug(message: String, values: LoggedValue*): F[Unit]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def info(message: String, values: LoggedValue*): F[Unit]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def warn(message: String, values: LoggedValue*): F[Unit]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def error(message: String, values: LoggedValue*): F[Unit]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Basically, that&#x27;s the main user API you can interact with throughout your code. It resembles well-known solutions,
keeping in mind that logging is an effect, though introducing the concept of <code>LoggedValue</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="representation">Representation<a href="#representation" class="hash-link" aria-label="Direct link to Representation" title="Direct link to Representation">​</a></h2><p>To represent a value in logs we use a concept of <code>Loggable</code> (it&#x27;s a typeclass). It describes how a value of some type
can be logged, both as a string representation in log message and as a component of structured logging. Given an
instance of <code>Loggable</code> for a type, a value of the type can be converted into the final internal representation
called <code>LoggedValue</code> and thus logged in a way that you provided.<br>
<!-- -->There are multiple predefined ways to create an instance of <code>Loggable</code>, many of them can be found
in <code>tofu.logging.Loggable</code> object:</p><ul><li><code>Loggable.empty</code> for no-op logging of value</li><li><code>Loggable.show</code> for using <code>cats.Show</code> instance as string representaion</li><li><code>Loggable.either</code> for logging either of <code>A</code> and <code>B</code></li><li>provided instances for all primitive types, as well as stdlib&#x27;s collections and collections from Cats</li><li>java.time.* instances</li></ul><p>Of course, you can describe your <code>Loggable</code> instance yourself by extending existing traits that pre-implement some
functionality:</p><ul><li><code>DictLoggable</code> for multi-field objects</li><li><code>ToStringLoggable</code> for using <code>.toString</code> for logging</li><li><code>HideLoggable</code> to exclude value from logging</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loggable-example">Loggable example<a href="#loggable-example" class="hash-link" aria-label="Direct link to Loggable example" title="Direct link to Loggable example">​</a></h3><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats.syntax.semigroup._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class User(name: String, surname: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">implicit val userLoggable = new DictLoggable[User] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  override def fields[I, V, R, S](a: User, i: I)(implicit r: LogRenderer[I, V, R, S]): R = {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    r.addString(&quot;name&quot;, a.name, i) |+| r.addString(&quot;surname&quot;, a.surname, i)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  override def logShow(a: User): String = s&quot;name = ${a.name}, surname = ${a.surname}&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s take a look at this example.<br>
<!-- -->First, we define a loggable for our <code>User</code> class as a <code>DictLoggable</code> which means that we want to log it as a multi-field
object with structure.<br>
<!-- -->Second, we define two methods that describe how <code>User</code> should be logged:</p><ul><li><code>fields</code>, that represents <code>User</code> as a structure, containing two fields with their respective names and values</li><li><code>logShow</code>, that represents <code>User</code> as a string in a log message</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="loggable-derivation">Loggable derivation<a href="#loggable-derivation" class="hash-link" aria-label="Direct link to Loggable derivation" title="Direct link to Loggable derivation">​</a></h2><p>a
Tofu has integration with <a href="https://github.com/tofu-tf/derevo" target="_blank" rel="noopener noreferrer">derevo</a> library. It allows you to easily generate
instances of <code>Loggable[YourClass]</code> for case classes or ADTs:</p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.derivation.loggable</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import derevo.derive</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Query(value: String, size: Int, isTagged: Tagged, tag: Tag)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Tagged(b: Option[Boolean])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sealed trait Tag</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class DatabaseTag(db: String) extends Tag</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case object InMemoryTag extends Tag</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>so when logged</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-loggable-generation">Configuring Loggable generation<a href="#configuring-loggable-generation" class="hash-link" aria-label="Direct link to Configuring Loggable generation" title="Direct link to Configuring Loggable generation">​</a></h3><p>Tofu has several annotations to configure generation of <code>Loggable</code></p><ul><li><p><code>@hidden</code></p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.derivation.{loggable, hidden}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import derevo.derive</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class User(name: String, @hidden() password: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>User(&quot;tofu&quot;, &quot;pass&quot;)</code> will be logged as <code>User{name=tofu}</code></p></li><li><p><code>@masked</code></p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.derivation.{loggable, masked, MaskMode}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import derevo.derive</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Card(@masked(MaskMode.Erase) expirationDate: String, @masked(MaskMode.ForLength(4, 12)) cardNumber: String, @masked() owner: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Card(737, &quot;1244345632322311&quot;, &quot;TOFU PETROV&quot;)</code> will be logged as <code>Card{expirationDate=...,cardNumber=1244########2311,owner=**** ******}</code></p></li><li><p><code>@unembed</code></p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.derivation.{loggable, unembed}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import derevo.derive</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Scientist(@unembed owner: Person, age: Option[Int])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">@derive(loggable)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Person(name: String)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Room(Person(&quot;Karl Sagan&quot;), None)</code> will be logged as <code>Room{name=Karl Sagan, age=None}</code></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creation">Creation<a href="#creation" class="hash-link" aria-label="Direct link to Creation" title="Direct link to Creation">​</a></h2><p>Creating an instance of <code>Logging</code> in Tofu is an effect itself. You can use helper class <code>Logs</code> that can produce values
of type <code>I[Logging[F]]</code> (where <code>I</code> and <code>F</code> are intended to be two different effects, former is a <code>I</code>nitialization
effect (<code>Task</code> or <code>IO</code>)  and latter is some ReaderT-ish effect or just main program effect type, but they can be the
same though) and define a behaviour of your <code>Logging</code> instances. An instance of <code>Logs</code> is supposed to be shared by
different parts of user code. It&#x27;s not a restriction though.</p><p>Tofu logs are built on top of existing Java logging infrastructure hence each logger for some class needs to have
distinctive name, as well as whole logging system has to be configured with a <code>logback.xml</code> (default configuration does
exist though).</p><p><code>Logs</code> methods close the first requirement in different ways:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plain-logging">Plain <code>Logging</code><a href="#plain-logging" class="hash-link" aria-label="Direct link to plain-logging" title="Direct link to plain-logging">​</a></h3><ul><li>by asking that name from user:
For example here we create named instance and pass it explicitly.</li></ul><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.monadic._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class MyService[F[_] : Monad](logger: Logging[F]) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def makeFoo(arg: String): F[Int] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logger.info(&quot;Doing simplest thing&quot;).as(arg.length) &lt;* logger.debug(&quot;Yep, counted length&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object MyService {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def makeNamed[I[_] : Monad, F[_] : Monad](logs: Logs[I, F]): I[MyService[F]] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logs.byName(&quot;my-service-log&quot;).map(new MyService[F](_))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>by generating that name from type-parameter, which is a class intended to use logging with:</li></ul><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">def makeNamed[I[_] : Monad, F[_] : Monad](logs: Logs[I, F]): I[MyService[F]] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  logs.byName(&quot;my-service-log&quot;).map(new MyService[F](_))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Logging instance created by this method for class <code>MyService[IO]</code> in package <code>com.bar.foo.pckg</code> will be
named <code>com.bar.foo.pckg.MyService</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="typesafe-servicelogging">Typesafe <code>ServiceLogging</code><a href="#typesafe-servicelogging" class="hash-link" aria-label="Direct link to typesafe-servicelogging" title="Direct link to typesafe-servicelogging">​</a></h3><p>Creating plain <code>Logging[F]</code> and using it around tends to be error-prune: one can easily pass logger created for
service <code>FooService</code> instead of <code>BarService</code>. Tofu has a solution — newtype <code>ServiceLogging[F, Service]</code>
and <code>LoggingCompanion</code> which contains simple type alias <code>Log[F[_]] = ServiceLogging[F, Service]</code>.</p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.monadic._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class FooService[F[_] : FooService.Log : Monad] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def makeFoo(arg: Int): F[String] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    info&quot;Doing yet another simplest thing&quot;.as(arg.toString) &lt;* debug&quot;Yep, called toString&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object FooService extends LoggingCompanion[FooService] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def make[I[_] : Functor, F[_] : Monad](logs: Logs[I, F]): I[FooService[F]] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logs.of[FooService].map(implicit l =&gt; new FooService[F])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that using it like <code>logs.named[&quot;foo&quot;]</code> or <code>logs.byName(&quot;foo&quot;)</code> is going to fail compilation.</p><p>This is also the intended way to create <code>Logging[F]</code> or <code>ServiceLogging[F, Service]</code> instance for your classes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ways-to-create-logs">Ways to create Logs<a href="#ways-to-create-logs" class="hash-link" aria-label="Direct link to Ways to create Logs" title="Direct link to Ways to create Logs">​</a></h3><p>There are multiple ways to create <code>Logs</code> instance, among them:</p><ul><li><code>Logs.sync</code> that requires a <code>cats.effect.Sync</code> instance for delaying side-effects</li><li><code>Logs.withContext</code> that requires a <code>cats.effect.Sync</code> instance for delaying side-effects and a proof that <code>F</code> has a
context to log</li><li><code>Logs.const</code> that wraps single <code>Logging</code> thus always returning the same instance</li><li><code>Logs.empty</code> that will produce a no-op <code>Logging</code> instances</li><li><code>Logs.combine</code> that combines two instances of <code>Logs</code>.
<code>Logging</code> instance that is created this way will be a combination of two underlying instances, produced by both <code>Logs</code>
. This means that both <code>Logging</code> implementations will be called in sequence</li></ul><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// for simplification, you can use whatever F you like</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">type F[A] = cats.effect.IO[A]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class MyService</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class MyTaglessService[F[_]]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// defines simple logging behaviour without any notion of contexts</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val syncLogs = Logs.sync[F, F]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// describing creation of logging instances and logging itself. When being run, this will log a message</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val effect: F[Unit] = for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  loggingBN &lt;- syncLogs.byName(&quot;my-logger&quot;) // you can create instances by name</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  loggingFS &lt;- syncLogs.forService[MyService] // you can create instances by type of your non-tagless-final services</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  loggingFS &lt;- syncLogs.of[MyTaglessService] // you can create instances by type of your tagless-final services</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _ &lt;- loggingBN.info(&quot;This is an INFO message&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _ &lt;- loggingFS.warn(&quot;This is a WARN message&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">} yield ()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context-logging">Context logging<a href="#context-logging" class="hash-link" aria-label="Direct link to Context logging" title="Direct link to Context logging">​</a></h2><p>It is possible to log the context of your computations along with actual log message. Often it comes along with
structured logging. To illustrate it consider this pseudocode:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">structuredLogger.info(&quot;I am a message&quot;, context = Map(&quot;transaction_id&quot; -&gt; 2342234, &quot;request_name&quot; -&gt; &quot;req&quot;))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">//it logs </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{ &quot;level&quot;: &quot;INFO&quot;, &quot;message&quot;: &quot;I am a message&quot;, &quot;transaction_id&quot;: 2342234, &quot;request_name&quot;: &quot;req&quot; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That&#x27;s neat, right? But it is verbose and clumsy to use, so tofu provides an abstraction for it.</p><p>If you have an instance of <code>tofu.Context</code> for your effect type and a <code>Loggable</code> for your context, you can have it logged
automagically. That is natural — describe how we can get a context from a computation <code>F</code> and a way to represent that
context in log, and we will ensure it will be logged anytime you use <code>Logging</code> operations. You can log that context to
string as well as use it as a part of structured logging.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h3><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.WithRun</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.derivation.loggable._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.{LoggableContext, Logging, LoggingCompanion, Logs}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats.{Functor, Monad}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.console._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.context._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.monadic._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.zioInstances.implicits._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import zio._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object Example extends zio.App {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  class BusinessService[F[_] : BusinessService.Log : Monad] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    private def logic(arg: String): String = arg.repeat(3).replace(&quot;a&quot;, &quot;b&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    def runLogic(arg: String): F[String] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      info&quot;Doing some business logic&quot; as logic(arg)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  object BusinessService extends LoggingCompanion[BusinessService] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    def make[I[_] : Functor, F[_] : Monad](logs: Logs[I, F]): I[BusinessService[F]] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      logs</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        .of[BusinessService]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        .map(implicit l =&gt; new BusinessService[F])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  case class RequestContext(id: Long, method: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  class Server[I[_] : Monad : Logging, F[_] : WithRun[*[_], I, RequestContext]](</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                                                 business: BusinessService[F]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                                               ) {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    def handleRequest(request: Server.Request): I[Server.Response] = for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      _ &lt;- info&quot;Got request $request&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      context = RequestContext(request.id, request.method)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      logicComputation = business.runLogic(request.body)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      result &lt;- runContext[F](logicComputation)(context)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      response = Server.Response(result)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      _ &lt;- info&quot;Got response $response&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } yield response</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  object Server {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    case class Request(id: Long, body: String, method: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    case class Response(answer: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  type Contextual[A] = RIO[RequestContext, A]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def run(args: List[String]): URIO[ZEnv, ExitCode] = {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    implicit val loggableContext: LoggableContext[Contextual] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LoggableContext.of[Contextual].instance[RequestContext]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    val contextLogs: Logs[Task, Contextual] = Logs.withContext[Task, Contextual]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    val mainLogs: Logs[Task, Task] = Logs.sync[Task, Task]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      implicit0(mainLogging: Logging[Task]) &lt;- mainLogs.byName(&quot;main&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      bs &lt;- BusinessService.make(contextLogs)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      server = new Server[Task, Contextual](bs)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      userRequest &lt;- readRequest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      response &lt;- server.handleRequest(userRequest)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      _ &lt;- putStrLn[Task](s&quot;Got response $response&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } yield ()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }.catchAll(_ =&gt; URIO.unit).as(zio.ExitCode.success)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def readRequest: Task[Server.Request] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      readStrLn[Task]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        .map(_.toLongOption)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        .someOrFail(new Exception(&quot;Please provide numeric id&quot;)),</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      readStrLn[Task],</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      readStrLn[Task]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ).mapN(Server.Request.apply)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="business-logic">Business Logic<a href="#business-logic" class="hash-link" aria-label="Direct link to Business Logic" title="Direct link to Business Logic">​</a></h4><p>We got <code>BusinessService</code> as our business logic. It does some stuff but most importantly it does not know it has any kind
of special logging. It just logs some stuff and all it needs for it is <code>Logging</code> instance.</p><p>As you can see it is created with the same factory-pattern as discussed before.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="server">Server<a href="#server" class="hash-link" aria-label="Direct link to Server" title="Direct link to Server">​</a></h4><p>Next we have a <code>Server</code> of some kind that should get some request, run some business logic on it and then return
response. Also, we want to have all the logs that business logic produces to have special RequestContext in it. To
achieve this we run the logic in special contextual effect type <code>F</code> which then can be evaluated into our main effect <code>I</code>
.
(More information on this can be found in scaladoc for <code>tofu.WithRun</code> etc.)
Moreover <code>Server</code> itself logs some messages and requires its own instance of <code>Logging</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="loggable-derivation-1">Loggable derivation<a href="#loggable-derivation-1" class="hash-link" aria-label="Direct link to Loggable derivation" title="Direct link to Loggable derivation">​</a></h4><p>As one can see in <a href="#representation">Representation part</a> for any of those logged values (like <code>$request</code>)  <code>Loggable</code>
instance should be in scope. In the example they are generated by macro, we just need to import it:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token namespace">tofu</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">logging</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">derivation</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">loggable</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">_</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="running">Running<a href="#running" class="hash-link" aria-label="Direct link to Running" title="Direct link to Running">​</a></h4><p>It is a simple ZIO-app that reads user input from console and passes it to server. So when running possible output will
look like this, if ran with <code>ConsoleContextLayout</code> in <code>logback.xml</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">sbt</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">10102</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">foo bar body</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GET</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain">:20:14 INFO  main - Got request Request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">id</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">10102</span><span class="token plain">,body</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">foo bar body,method</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">GET</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain">:20:14 INFO  c.t.c.n.c.Example</span><span class="token variable" style="color:rgb(156, 220, 254)">$BusinessService</span><span class="token plain"> - Doing some business logic</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">method</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">GET, </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">id</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">10102</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain">:20:14 INFO  main - Got response Response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">answer</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">foo bbr bodyfoo bbr bodyfoo bbr body</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Got response Response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">foo bbr bodyfoo bbr bodyfoo bbr body</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-extensions">Syntax extensions<a href="#syntax-extensions" class="hash-link" aria-label="Direct link to Syntax extensions" title="Direct link to Syntax extensions">​</a></h2><p>It&#x27;s much more convenient to use pre-defined syntax extensions for logging operations since they do all heavy lifting
for you:</p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats.effect._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats.syntax.functor._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import cats.{Monad, Show, Functor}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.syntax.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class User(name: String, surname: String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object User {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  implicit val userShow: Show[User]         = user =&gt; s&quot;name=${user.name}, surname=${user.surname}&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  implicit val userInstance: Loggable[User] = Loggable.show</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val user: User = User(&quot;name&quot;, &quot;surname&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">class MyService[F[_]: Logging: Monad] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def doLogging: F[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      _ &lt;- info&quot;This is a syntax demo: $user&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } yield ()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object MyService {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  def apply[I[_]: Functor, F[_]: Monad](implicit logs: Logs[I, F]): I[MyService[F]] = {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logs.forService[MyService[F]].map(implicit l =&gt; new MyService[F])</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// An instance of `Logs` is supposed to be shared between mupltiple classes (or a single one for a whole application)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Note that initializing effect of your application may differ from logging effect.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">implicit val logs: Logs[IO, IO] = Logs.sync[IO, IO]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val io: IO[Unit] = for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  service &lt;- MyService[IO, IO]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _       &lt;- service.doLogging</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">} yield ()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">io.unsafeRunSync()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 13:56:26.918 [main] INFO tofu.logging.Test$MyService - This is a syntax demo: name=name, surname=surname</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using a syntax we achieve a few important goals.<br>
<!-- -->First, it will log a message containing a string representation of your value of type <code>User</code> as you defined it
in <code>Loggable</code> instance.<br>
<!-- -->Second, it will create a <code>LoggedValue</code> from your <code>Loggable</code> description and pass it to underlying logger and
your <code>LogRendered</code>, so your structured logging will work as expected.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-logs4cats">Integration with logs4cats<a href="#integration-with-logs4cats" class="hash-link" aria-label="Direct link to Integration with logs4cats" title="Direct link to Integration with logs4cats">​</a></h2><p>There is a library for effectual logging named <a href="https://github.com/typelevel/log4cats" target="_blank" rel="noopener noreferrer">log4cats</a> which shares
the goal of representing logging as an effect and providing the ability to log context values. It is used by some of the
open-source libraries which may require you to pass an instance of <code>org.typelevel.log4cats.Logger</code> to it in order to
log something. Module <code>tofu-logging-log4cats</code> contains a helper that can create an instance of log4cats <code>Logger</code> from
our existing
<code>tofu.logging.Logging</code> one. If our <code>Logging</code> instance is contextual, it will continue leveraging that despite being
wrapped in log4cats <code>Logger</code>. Moveover, it will log context values that are passed to log4cats <code>Logger</code> API
as <code>Map[String, String]</code>.<br>
<!-- -->This means that not only you will not lose your context, but additional values that are passed to <code>Logger</code> will also be
logged.<br>
<!-- -->Let&#x27;s take a look at the example:</p><div class="language-scala:reset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala:reset codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">import org.typelevel.log4cats.{Logger, StructuredLogger}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.env.Env</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Suppose we have some external APIs that leverage log4cats&#x27;s Logger and StructuredLogger</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">def logWithLog4Cats[F[_]](implicit logger: Logger[F]): F[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logger.info(&quot;Hello Tofu!&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">def logWithLog4CatsContextual[F[_]](implicit logger: StructuredLogger[F]): F[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logger.info(Map(&quot;field&quot; -&gt; &quot;value&quot;))(&quot;Hello contextual Tofu!&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// And we have our own context that can be logged as a structure</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">case class Context(start: Long)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">object Context {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  implicit val loggable: Loggable[Context] = new DictLoggable[Context] {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    override def fields[I, V, R, S](a: Context, i: I)(implicit r: LogRenderer[I, V, R, S]): R =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      r.addInt(&quot;start&quot;, a.start.toInt, i)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    override def logShow(a: Context): String                                                  =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      a.toString</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// This context will be embedded in our Env monad and be logged at each logging call</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">type AppEnv[A] = Env[Context, A]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">implicit val loggableContext: LoggableContext[AppEnv] = LoggableContext.of[AppEnv].instance</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val logs: Logs[AppEnv, AppEnv]                        = Logs.withContext[AppEnv, AppEnv]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// first we need to import converter function</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import tofu.logging.log4cats._</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// then we can create an instance of Logger, passing an instance of tofu.logging.Logging implicitly</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val env1: AppEnv[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  logs.byName(&quot;Main&quot;).flatMap { implicit logging =&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    implicit val log4catsLogger: StructuredLogger[AppEnv] = toLog4CatsLogger</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logWithLog4Cats *&gt; logWithLog4CatsContextual</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// or passing it explicitly in case you have more than one Logging instance in scope</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val env2: AppEnv[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  logs.byName(&quot;Main&quot;).flatMap { logging =&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    implicit val log4catsLogger: StructuredLogger[AppEnv] = toLog4CatsLogger(logging)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    logWithLog4Cats *&gt; logWithLog4CatsContextual</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// you can also create an instance of Logger for each call, but this is not advised since it will make unnecessary allocations</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">val env3: AppEnv[Unit] =</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  logs.byName(&quot;Main&quot;).flatMap(implicit logging =&gt; logWithLog4Cats *&gt; logWithLog4CatsContextual)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// we can then import Scheduler and run our Env with some context</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">import monix.execution.Scheduler.Implicits.global</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">(for {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _ &lt;- env1.run(Context(123))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _ &lt;- env2.run(Context(456))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  _ &lt;- env3.run(Context(789))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">} yield ()).runSyncUnsafe(Duration.Inf)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// If we have a configured layout for structured logging, supporting context values (i.e. tofu.logging.ElkLayout)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// we will see JSON logs that contain not only values from our Context, but also values that were passed to log4cats Logger by the external API</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.059Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello Tofu!&quot;,&quot;start&quot;:123}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.167Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello contextual Tofu!&quot;,&quot;start&quot;:123,&quot;field&quot;:&quot;value&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.168Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello Tofu!&quot;,&quot;start&quot;:456}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.168Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello contextual Tofu!&quot;,&quot;start&quot;:456,&quot;field&quot;:&quot;value&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.169Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello Tofu!&quot;,&quot;start&quot;:789}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// {&quot;@timestamp&quot;:&quot;2020-10-31T14:11:31.169Z&quot;,&quot;loggerName&quot;:&quot;Main&quot;,&quot;threadName&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;message&quot;:&quot;Hello contextual Tofu!&quot;,&quot;start&quot;:789,&quot;field&quot;:&quot;value&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-09-13T15:20:33.000Z">Sep 13, 2021</time></b> by <b>Антон Войцишевский</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#preface" class="table-of-contents__link toc-highlight">Preface</a></li><li><a href="#whats-wrong-and-how-to-fix-that" class="table-of-contents__link toc-highlight">What&#39;s wrong (and how to fix that)?</a></li></ul></li><li><a href="#representation" class="table-of-contents__link toc-highlight">Representation</a><ul><li><a href="#loggable-example" class="table-of-contents__link toc-highlight">Loggable example</a></li></ul></li><li><a href="#loggable-derivation" class="table-of-contents__link toc-highlight">Loggable derivation</a><ul><li><a href="#configuring-loggable-generation" class="table-of-contents__link toc-highlight">Configuring Loggable generation</a></li></ul></li><li><a href="#creation" class="table-of-contents__link toc-highlight">Creation</a><ul><li><a href="#plain-logging" class="table-of-contents__link toc-highlight">Plain <code>Logging</code></a></li><li><a href="#typesafe-servicelogging" class="table-of-contents__link toc-highlight">Typesafe <code>ServiceLogging</code></a></li><li><a href="#ways-to-create-logs" class="table-of-contents__link toc-highlight">Ways to create Logs</a></li></ul></li><li><a href="#context-logging" class="table-of-contents__link toc-highlight">Context logging</a><ul><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></li><li><a href="#syntax-extensions" class="table-of-contents__link toc-highlight">Syntax extensions</a></li><li><a href="#integration-with-logs4cats" class="table-of-contents__link toc-highlight">Integration with logs4cats</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tofu/docs">Getting started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tofu/users">User showcase</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tofu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/tofu_scala" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram Group (EN|RU)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitter.im/tinkoff-tofu/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter Group (EN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tofu/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tofu-tf/tofu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Tinkoff.ru</div></div></div></footer></div>
<script src="/tofu/assets/js/runtime~main.69bc1755.js"></script>
<script src="/tofu/assets/js/main.90d0e17d.js"></script>
</body>
</html>